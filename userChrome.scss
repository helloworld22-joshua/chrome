:root {
	// Global CSS variables for sizing, transitions, and theme
	--duration: 0s;
	--transition-time: 0.2s;
	--expanded-width: 250px;
	--box-shadow: 0 0 1.2rem hsla(0, 0%, 7%, 0.9);
	--sidebar-width: 44px;
}

/* Remove green dot (attention badge) from extension buttons */
#unified-extensions-button[attention]>.toolbarbutton-icon,
.unified-extensions-item[attention]>.unified-extensions-item-action-button.toolbarbutton-1>.toolbarbutton-badge-stack {
	background-image: none !important;
}

/* Hide the main tabs toolbar (removes native Firefox tabs UI) */
#TabsToolbar:not([customizing="true"]),
#TabsToolbar {
	visibility: collapse !important;
}

/* Sidebar base styling for Sidebery or similar extensions */
#sidebar-box[sidebarcommand="_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action"] {
	position: relative; // Ensures correct stacking and positioning
	width: var(--sidebar-width) !important;
	min-width: unset !important;
	max-width: unset !important;
	transition: width var(--transition-time) ease-in-out !important;
	will-change: width;

	// Sidebar expansion
	&:hover {
		width: var(--expanded-width) !important;
	}

	// Hide splitter for Sidebery extension
	&+#sidebar-splitter {
		display: none !important;
	}

	// Hide sidebar header for a cleaner look
	#sidebar-header {
		visibility: collapse;
	}
}

/* ===========================
   MacOS specific styles
   =========================== */
@media (-moz-platform: macos) {

	// Add left padding to nav-bar to make space for window controls
	:root:not([customizing="true"]) #nav-bar:not([inFullscreen]) {
		padding-left: 80px !important;
	}

	// Show window controls in the TabsToolbar on Mac
	:root:not([customizing="true"]) #TabsToolbar .titlebar-buttonbox-container {
		position: absolute;
		display: block;
		visibility: visible !important;
		top: 12px;
		left: 0px;
	}
}

/* ===========================
   Linux/GTK specific styles
   =========================== */
@media (-moz-gtk-csd-available),
(-moz-platform: linux) {

	// Set sidebar width for Linux
	#sidebar-box[sidebarcommand="_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action"] {
		min-width: var(--linux-sidebar-width) !important;
		width: var(--linux-sidebar-width) !important;
		max-width: var(--linux-sidebar-width) !important;
	}

	#sidebar-box[sidebarcommand=_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action]:hover {
		min-width: var(--expanded-width) !important;
	}

	// Remove background and shadow from toolbars for a flat look
	.browser-toolbar:not(.titlebar-color) {
		background-color: transparent !important;
		box-shadow: none !important;
	}

	// Remove extra padding from menubar
	#toolbar-menubar {
		padding-top: 0px !important;
	}

	// Fix for window controls not working in some Firefox versions
	:root[tabsintitlebar] #titlebar {
		will-change: auto !important;
	}

	// Hide window controls in menubar when not needed
	#toolbar-menubar .titlebar-buttonbox-container {
		visibility: hidden !important;
	}

	// Add rounded corners to nav-bar when not tiled or customizing
	:root[tabsintitlebar][sizemode="normal"]:not([gtktiledwindow="true"]):not([customizing="true"]) #nav-bar {
		border-top-left-radius: env(-moz-gtk-csd-titlebar-radius);
		border-top-right-radius: env(-moz-gtk-csd-titlebar-radius);
	}

	// Set window control button variables for normal and lwtheme
	:root[tabsintitlebar]:not([customizing="true"]) {
		--uc-win-ctrl-btn-width: 38px;
		--uc-win-ctrl-padding: 12px;
		--uc-win-ctrl-vertical-offset: 8px;
		--uc-win-ctrl-drag-space: 20px;
	}

	:root[tabsintitlebar][lwtheme]:not([customizing="true"]) {
		--uc-win-ctrl-btn-width: 30px;
		--uc-win-ctrl-padding: 12px;
		--uc-win-ctrl-vertical-offset: 5px;
		--uc-win-ctrl-drag-space: 20px;
	}

	// Dynamically set nav-bar padding based on which window controls are present
	@media (-moz-gtk-csd-minimize-button),
	(-moz-gtk-csd-maximize-button),
	(-moz-gtk-csd-close-button) {
		#nav-bar {
			--uc-navbar-padding: calc(var(--uc-win-ctrl-btn-width) * 1);
		}
	}

	@media (-moz-gtk-csd-minimize-button) and (-moz-gtk-csd-maximize-button),
	(-moz-gtk-csd-minimize-button) and (-moz-gtk-csd-close-button),
	(-moz-gtk-csd-maximize-button) and (-moz-gtk-csd-close-button) {
		#nav-bar {
			--uc-navbar-padding: calc(var(--uc-win-ctrl-btn-width) * 2);
		}
	}

	@media (-moz-gtk-csd-minimize-button) and (-moz-gtk-csd-maximize-button) and (-moz-gtk-csd-close-button) {
		#nav-bar {
			--uc-navbar-padding: calc(var(--uc-win-ctrl-btn-width) * 3);
		}
	}

	// Place window controls inside nav-bar, right or left depending on placement
	@media (-moz-gtk-csd-minimize-button),
	(-moz-gtk-csd-maximize-button),
	(-moz-gtk-csd-close-button) {
		@media not (-moz-gtk-csd-reversed-placement) {
			#nav-bar {
				// Add right padding for window controls
				padding-inline: 0 calc(var(--uc-navbar-padding, 0) + var(--uc-win-ctrl-padding) + var(--uc-win-ctrl-drag-space)) !important;
			}

			.titlebar-buttonbox-container {
				right: 0; // Place controls on the right
			}
		}

		@media (-moz-gtk-csd-reversed-placement) {
			#nav-bar {
				// Add left padding for window controls
				padding-inline: calc(var(--uc-navbar-padding, 0) + var(--uc-win-ctrl-padding) + var(--uc-win-ctrl-drag-space)) 0 !important;
			}

			.titlebar-buttonbox-container {
				left: 0; // Place controls on the left
			}
		}
	}

	// Hide window controls in fullscreen or DOM fullscreen
	#navigator-toolbox[style*="margin-top: -"] .titlebar-buttonbox-container,
	[inDOMFullscreen="true"] .titlebar-buttonbox-container {
		transform: translateY(-100px)
	}

	/* Place window controls inside nav-bar (address bar) for Linux */
	#nav-bar .titlebar-buttonbox-container {
		display: flex !important;
		position: absolute !important;
		top: 0;
		right: 0;
		height: 100%;
		align-items: center;
		z-index: 10;
	}

	#nav-bar {
		padding-right: var(--uc-window-control-width, 100px) !important;
		position: relative;
	}

	:root:not([inFullscreen]) #nav-bar {
		margin-top: 0 !important;
		z-index: 2;
	}

	:root[inFullscreen] #nav-bar {
		border-right: none !important;
	}

	#navigator-toolbox[style*="margin-top: -"] .titlebar-buttonbox-container,
	[inDOMFullscreen="true"] .titlebar-buttonbox-container {
		transform: translateY(-100px)
	}
}